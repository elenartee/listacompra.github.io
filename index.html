<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>🛒 Lista de la compra</title>

  <!-- Tailwind CSS desde CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

  <style>
    :root { 
      --safe-top: env(safe-area-inset-top); 
      --safe-bottom: env(safe-area-inset-bottom); 
    }
    /* iOS: evita zoom al enfocar inputs */
    input { font-size: 16px; }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>

  <script>
    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAiNkVD6eVwMbq86IyurqAKOZCfdU6l2AE",
      authDomain: "listacompra-a8174.firebaseapp.com",
      databaseURL: "https://listacompra-a8174-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "listacompra-a8174",
      storageBucket: "listacompra-a8174.firebasestorage.app",
      messagingSenderId: "1021160831609",
      appId: "1:1021160831609:web:49e4cdc4909612b156f2a8",
      measurementId: "G-QYE9WETVMW"
    };

    // Inicializa Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database(app);
    const dbRef = database.ref("shoppingList"); // Conecta a la base de datos "shoppingList"
    
    // ====== Estado ======
    let items = [];

    // ====== Elementos del DOM ======
    const input = document.getElementById('item-input');
    const addBtn = document.getElementById('add-btn');
    const listEl = document.getElementById('list');
    const emptyState = document.getElementById('empty-state');
    const clearAllBtn = document.getElementById('clear-all');
    const countEl = document.getElementById('count');

    // ====== Lógica de renderizado ======
    function render() {
      listEl.innerHTML = '';

      if (!items.length) {
        emptyState.classList.remove('hidden');
      } else {
        emptyState.classList.add('hidden');
      }

      items.forEach((text, idx) => {
        const li = document.createElement('li');
        li.className = 'bg-white border border-gray-200 rounded-2xl shadow-sm px-4 py-3 flex items-center justify-between';

        const span = document.createElement('span');
        span.textContent = text;
        span.className = 'text-base break-words flex-1 pr-3';

        const delBtn = document.createElement('button');
        delBtn.className = 'inline-flex items-center justify-center rounded-xl border border-red-200 text-red-600 px-3 py-2 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-400';
        delBtn.setAttribute('aria-label', `Eliminar ${text}`);
        delBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5" aria-hidden="true">
          <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm2.03 6.72a.75.75 0 1 0-1.06-1.06L12 8.88l-1.97-1.97a.75.75 0 0 0-1.06 1.06L10.94 9.94l-1.97 1.97a.75.75 0 1 0 1.06 1.06L12 11.06l1.97 1.97a.75.75 0 0 0 1.06-1.06L13.06 9.94l1.97-1.97Z" clip-rule="evenodd" />
        </svg>`;
        delBtn.addEventListener('click', () => {
          items.splice(idx, 1);
          saveList(items);
          render();
        });

        li.appendChild(span);
        li.appendChild(delBtn);
        listEl.appendChild(li);
      });

      countEl.textContent = items.length === 1 ? '1 producto' : `${items.length} productos`;
    }

    // ====== Funciones de almacenamiento en Firebase ======
    function saveList(list) {
      dbRef.set(list.reduce((acc, item, idx) => {
        acc[`item${idx}`] = item;
        return acc;
      }, {}));
    }

    // ====== Sincronización en tiempo real ======
    function loadList() {
      dbRef.on("value", (snapshot) => {
        const data = snapshot.val();
        items = data ? Object.values(data) : [];
        render(); // Rerender la lista después de cargarla desde Firebase
      });
    }

    // ====== Acciones ======
    function addItem() {
      const text = input.value.trim();
      if (!text) {
        alert('Escribe un producto antes de añadir');
        input.focus();
        return;
      }
      items.push(text);
      saveList(items);
      input.value = '';
      render();
    }

    function clearAll() {
      if (!items.length) return;
      const ok = confirm('¿Borrar toda la lista?');
      if (ok) {
        items = [];
        saveList(items);
        render();
      }
    }

    // ====== Eventos ======
    addBtn.addEventListener('click', addItem);
    clearAllBtn.addEventListener('click', clearAll);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        addItem();
      }
    });

    // Inicialización
    loadList(); // Cargar la lista desde Firebase al iniciar
  </script>

</body>
</html>
